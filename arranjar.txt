-- ==================== SCRIPT DE RESET E POPULATE ====================
-- Este script limpa toda a base de dados e preenche com dados iniciais
-- âš ï¸ ATENÃ‡ÃƒO: Vai apagar TODOS os dados existentes!
-- ==================== ==================== ====================

USE filmkeepr;

-- ==================== 1. DESATIVAR VERIFICAÃ‡Ã•ES DE CHAVES ESTRANGEIRAS ====================
SET FOREIGN_KEY_CHECKS = 0;

-- ==================== 2. LIMPAR TODAS AS TABELAS ====================
TRUNCATE TABLE reviews;
TRUNCATE TABLE watchlist;
TRUNCATE TABLE favorites;
TRUNCATE TABLE movie_genres;
TRUNCATE TABLE genres;
TRUNCATE TABLE movies;
TRUNCATE TABLE users;

-- ==================== 3. REATIVAR VERIFICAÃ‡Ã•ES ====================
SET FOREIGN_KEY_CHECKS = 1;

-- ==================== 4. INSERIR UTILIZADORES ====================
-- Passwords: Para todos os utilizadores a password Ã© "123456"
-- Hash gerado com bcrypt (10 rounds): $2b$10$YX5V5YfVqJ5V5YfVqJ5V5.N5V5YfVqJ5V5YfVqJ5V5YfVqJ5V5Y

INSERT INTO users (username, email, password_hash, is_admin) VALUES
('root', 'admin@filmkeepr.com', '$2b$10$rQ3qK3JZ3qK3JZ3qK3JZ3.K3JZ3qK3JZ3qK3JZ3qK3JZ3qK3JZ3q', 1),
('miguel', 'miguel@gmail.com', '$2b$10$rQ3qK3JZ3qK3JZ3qK3JZ3.K3JZ3qK3JZ3qK3JZ3qK3JZ3qK3JZ3q', 0),
('norberto', 'norberto@gmail.com', '$2b$10$rQ3qK3JZ3qK3JZ3qK3JZ3.K3JZ3qK3JZ3qK3JZ3qK3JZ3qK3JZ3q', 0),
('maria', 'maria@gmail.com', '$2b$10$rQ3qK3JZ3qK3JZ3qK3JZ3.K3JZ3qK3JZ3qK3JZ3qK3JZ3qK3JZ3q', 0),
('joao', 'joao@gmail.com', '$2b$10$rQ3qK3JZ3qK3JZ3qK3JZ3.K3JZ3qK3JZ3qK3JZ3qK3JZ3qK3JZ3q', 0);

-- ==================== 5. INSERIR GÃ‰NEROS ====================
INSERT INTO genres (name) VALUES
('AÃ§Ã£o'),
('Aventura'),
('AnimaÃ§Ã£o'),
('ComÃ©dia'),
('Crime'),
('DocumentÃ¡rio'),
('Drama'),
('Fantasia'),
('FicÃ§Ã£o CientÃ­fica'),
('Terror'),
('Thriller'),
('Romance'),
('MistÃ©rio'),
('FamÃ­lia'),
('Guerra'),
('MÃºsica'),
('HistÃ³ria'),
('Western');

-- ==================== 6. INSERIR FILMES DE EXEMPLO ====================
INSERT INTO movies (title, synopsis, duration_minutes, release_year, poster_path, tmdb_id) VALUES
('The Shawshank Redemption', 'Dois homens presos desenvolvem uma amizade ao longo de vÃ¡rios anos, encontrando consolo e eventual redenÃ§Ã£o atravÃ©s de atos de decÃªncia comum.', 142, 1994, '/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg', 278),
('The Godfather', 'O patriarca envelhecido de uma dinastia do crime organizado transfere o controle de seu impÃ©rio clandestino para seu filho relutante.', 175, 1972, '/3bhkrj58Vtu7enYsRolD1fZdja1.jpg', 238),
('The Dark Knight', 'Quando a ameaÃ§a conhecida como o Coringa causa estragos e caos nas pessoas de Gotham, Batman deve aceitar um dos maiores testes psicolÃ³gicos e fÃ­sicos.', 152, 2008, '/qJ2tW6WMUDux911r6m7haRef0WH.jpg', 155),
('Pulp Fiction', 'As vidas de dois assassinos da mÃ¡fia, um boxeador, a esposa de um gangster e um par de bandidos se entrelaÃ§am em quatro histÃ³rias de violÃªncia e redenÃ§Ã£o.', 154, 1994, '/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg', 680),
('Forrest Gump', 'As presidÃªncias de Kennedy e Johnson, a Guerra do VietnÃ£, Watergate e outros eventos histÃ³ricos se desenrolam atravÃ©s da perspectiva de um homem do Alabama.', 142, 1994, '/arw2vcBveWOVZr6pxd9XTd1TdQa.jpg', 13),
('Inception', 'Um ladrÃ£o que rouba segredos corporativos atravÃ©s da tecnologia de compartilhamento de sonhos recebe a tarefa inversa de plantar uma ideia na mente de um CEO.', 148, 2010, '/9gk7adHYeDvHkCSEqAvQNLV5Uge.jpg', 27205),
('The Matrix', 'Um hacker descobre que a realidade Ã© uma simulaÃ§Ã£o criada por mÃ¡quinas e se junta a uma rebeliÃ£o para libertar a humanidade.', 136, 1999, '/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg', 603),
('Interstellar', 'Uma equipe de exploradores viaja atravÃ©s de um buraco de minhoca no espaÃ§o na tentativa de garantir a sobrevivÃªncia da humanidade.', 169, 2014, '/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg', 157336),
('The Lion King', 'Simba, um jovem leÃ£o, deve aceitar seu destino como rei apÃ³s a morte de seu pai.', 88, 1994, '/sKCr78MXSLixwmZ8DyJLrpMsd15.jpg', 8587),
('Toy Story', 'Brinquedos ganham vida quando humanos nÃ£o estÃ£o por perto, e um novo brinquedo ameaÃ§a a posiÃ§Ã£o de lÃ­der de Woody.', 81, 1995, '/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg', 862);

-- ==================== 7. ASSOCIAR FILMES COM GÃ‰NEROS ====================
-- The Shawshank Redemption: Drama, Crime
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(1, 7), (1, 5);

-- The Godfather: Drama, Crime
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(2, 7), (2, 5);

-- The Dark Knight: AÃ§Ã£o, Crime, Drama
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(3, 1), (3, 5), (3, 7);

-- Pulp Fiction: Crime, Drama
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(4, 5), (4, 7);

-- Forrest Gump: Drama, Romance
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(5, 7), (5, 12);

-- Inception: AÃ§Ã£o, FicÃ§Ã£o CientÃ­fica, Thriller
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(6, 1), (6, 9), (6, 11);

-- The Matrix: AÃ§Ã£o, FicÃ§Ã£o CientÃ­fica
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(7, 1), (7, 9);

-- Interstellar: Aventura, Drama, FicÃ§Ã£o CientÃ­fica
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(8, 2), (8, 7), (8, 9);

-- The Lion King: AnimaÃ§Ã£o, Aventura, Drama, FamÃ­lia
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(9, 3), (9, 2), (9, 7), (9, 14);

-- Toy Story: AnimaÃ§Ã£o, Aventura, ComÃ©dia, FamÃ­lia
INSERT INTO movie_genres (movie_id, genre_id) VALUES
(10, 3), (10, 2), (10, 4), (10, 14);

-- ==================== 8. INSERIR FAVORITOS ====================
-- Miguel: The Shawshank Redemption, Inception, The Matrix
INSERT INTO favorites (user_id, movie_id, title, poster_path) VALUES
(2, 1, 'The Shawshank Redemption', '/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg'),
(2, 6, 'Inception', '/9gk7adHYeDvHkCSEqAvQNLV5Uge.jpg'),
(2, 7, 'The Matrix', '/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg');

-- Norberto: The Dark Knight, Pulp Fiction, Interstellar
INSERT INTO favorites (user_id, movie_id, title, poster_path) VALUES
(3, 3, 'The Dark Knight', '/qJ2tW6WMUDux911r6m7haRef0WH.jpg'),
(3, 4, 'Pulp Fiction', '/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg'),
(3, 8, 'Interstellar', '/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg');

-- Maria: Forrest Gump, The Lion King, Toy Story
INSERT INTO favorites (user_id, movie_id, title, poster_path) VALUES
(4, 5, 'Forrest Gump', '/arw2vcBveWOVZr6pxd9XTd1TdQa.jpg'),
(4, 9, 'The Lion King', '/sKCr78MXSLixwmZ8DyJLrpMsd15.jpg'),
(4, 10, 'Toy Story', '/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg');

-- ==================== 9. INSERIR WATCHLIST ====================
-- Miguel: The Godfather, Pulp Fiction
INSERT INTO watchlist (user_id, movie_id, title, poster_path) VALUES
(2, 2, 'The Godfather', '/3bhkrj58Vtu7enYsRolD1fZdja1.jpg'),
(2, 4, 'Pulp Fiction', '/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg');

-- Norberto: The Shawshank Redemption, The Lion King
INSERT INTO watchlist (user_id, movie_id, title, poster_path) VALUES
(3, 1, 'The Shawshank Redemption', '/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg'),
(3, 9, 'The Lion King', '/sKCr78MXSLixwmZ8DyJLrpMsd15.jpg');

-- JoÃ£o: Inception, Interstellar, The Matrix
INSERT INTO watchlist (user_id, movie_id, title, poster_path) VALUES
(5, 6, 'Inception', '/9gk7adHYeDvHkCSEqAvQNLV5Uge.jpg'),
(5, 8, 'Interstellar', '/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg'),
(5, 7, 'The Matrix', '/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg');

-- ==================== 10. INSERIR REVIEWS ====================
-- Miguel reviews
INSERT INTO reviews (user_id, movie_id, review_date, rating, comment) VALUES
(2, 1, '2024-01-15', 10, 'Obra-prima absoluta! Melhor filme de todos os tempos.'),
(2, 6, '2024-02-20', 9, 'Complexo e fascinante. Christopher Nolan no seu melhor.'),
(2, 7, '2024-03-10', 9, 'RevolucionÃ¡rio e visionÃ¡rio. Mudou o cinema de ficÃ§Ã£o cientÃ­fica.');

-- Norberto reviews
INSERT INTO reviews (user_id, movie_id, review_date, rating, comment) VALUES
(3, 3, '2024-01-20', 10, 'Heath Ledger estÃ¡ fenomenal como Coringa. Obra-prima.'),
(3, 4, '2024-02-15', 9, 'DiÃ¡logos brilhantes e narrativa nÃ£o-linear perfeita.'),
(3, 8, '2024-03-05', 10, 'Emocionante e cientificamente interessante. Adoro!');

-- Maria reviews
INSERT INTO reviews (user_id, movie_id, review_date, rating, comment) VALUES
(4, 5, '2024-01-25', 9, 'Emocionante e inspirador. Tom Hanks estÃ¡ incrÃ­vel.'),
(4, 9, '2024-02-10', 10, 'ClÃ¡ssico da Disney. Perfeito para toda a famÃ­lia.'),
(4, 10, '2024-03-01', 9, 'AnimaÃ§Ã£o revolucionÃ¡ria. Toy Story Ã© atemporal.');

-- JoÃ£o reviews
INSERT INTO reviews (user_id, movie_id, review_date, rating, comment) VALUES
(5, 2, '2024-01-30', 10, 'Melhor filme de gangsters de sempre. Marlon Brando Ã©pico.'),
(5, 7, '2024-02-25', 9, 'Efeitos especiais incrÃ­veis. HistÃ³ria envolvente.');

-- ==================== 11. VERIFICAÃ‡ÃƒO FINAL ====================
-- Ver estatÃ­sticas apÃ³s populate
SELECT 
  (SELECT COUNT(*) FROM users) as total_users,
  (SELECT COUNT(*) FROM movies) as total_movies,
  (SELECT COUNT(*) FROM genres) as total_genres,
  (SELECT COUNT(*) FROM favorites) as total_favorites,
  (SELECT COUNT(*) FROM watchlist) as total_watchlist,
  (SELECT COUNT(*) FROM reviews) as total_reviews;

-- Ver utilizadores criados
SELECT id_user, username, email, is_admin FROM users;

-- Ver filmes inseridos
SELECT id_movie, title, release_year, duration_minutes FROM movies;

-- Ver favoritos por utilizador
SELECT 
  u.username,
  COUNT(f.id) as total_favorites
FROM users u
LEFT JOIN favorites f ON u.id_user = f.user_id
GROUP BY u.username;

-- Ver watchlist por utilizador
SELECT 
  u.username,
  COUNT(w.id) as total_watchlist
FROM users u
LEFT JOIN watchlist w ON u.id_user = w.user_id
GROUP BY u.username;

-- Ver reviews por utilizador
SELECT 
  u.username,
  COUNT(r.id_review) as total_reviews,
  AVG(r.rating) as avg_rating
FROM users u
LEFT JOIN reviews r ON u.id_user = r.user_id
GROUP BY u.username;

-- ==================== 12. INFORMAÃ‡Ã•ES IMPORTANTES ====================

-- âš ï¸ NOTA SOBRE PASSWORDS:
-- Todos os utilizadores tÃªm a password: "123456"
-- O hash fornecido Ã© apenas um exemplo placeholder
-- 
-- Para gerar o hash correto da password "123456", executa no Node.js:
-- 
-- node -e "require('bcrypt').hash('123456', 10).then(h => console.log(h))"
-- 
-- Depois atualiza com o hash real:
-- UPDATE users SET password_hash = 'HASH_REAL_AQUI';

-- ==================== 13. QUERIES ÃšTEIS PARA TESTE ====================

-- Ver filme mais popular (favoritos + watchlist)
SELECT 
  m.title,
  COUNT(DISTINCT f.id) as favoritos,
  COUNT(DISTINCT w.id) as watchlist,
  COUNT(DISTINCT f.id) + COUNT(DISTINCT w.id) as popularidade
FROM movies m
LEFT JOIN favorites f ON m.id_movie = f.movie_id
LEFT JOIN watchlist w ON m.id_movie = w.movie_id
GROUP BY m.id_movie, m.title
ORDER BY popularidade DESC
LIMIT 5;

-- Ver filme mais bem avaliado
SELECT 
  m.title,
  AVG(r.rating) as media_rating,
  COUNT(r.id_review) as total_reviews
FROM movies m
INNER JOIN reviews r ON m.id_movie = r.movie_id
GROUP BY m.id_movie, m.title
ORDER BY media_rating DESC, total_reviews DESC
LIMIT 5;

-- Ver utilizador mais ativo
SELECT 
  u.username,
  COUNT(DISTINCT f.id) as favoritos,
  COUNT(DISTINCT w.id) as watchlist,
  COUNT(DISTINCT r.id_review) as reviews,
  (COUNT(DISTINCT f.id) + COUNT(DISTINCT w.id) + COUNT(DISTINCT r.id_review)) as atividade_total
FROM users u
LEFT JOIN favorites f ON u.id_user = f.user_id
LEFT JOIN watchlist w ON u.id_user = w.user_id
LEFT JOIN reviews r ON u.id_user = r.user_id
GROUP BY u.id_user, u.username
ORDER BY atividade_total DESC;

-- Ver gÃ©neros mais populares
SELECT 
  g.name,
  COUNT(mg.movie_id) as total_filmes
FROM genres g
LEFT JOIN movie_genres mg ON g.id_genres = mg.genre_id
GROUP BY g.id_genres, g.name
ORDER BY total_filmes DESC;

-- ==================== FIM DO SCRIPT ====================
-- Base de dados limpa e populada com sucesso! ðŸŽ¬
-- 
-- Credenciais de acesso:
-- Admin: root / 123456
-- Users: miguel, norberto, maria, joao / 123456
-- 
-- Total de registos:
-- - 5 utilizadores (1 admin)
-- - 10 filmes
-- - 18 gÃ©neros
-- - 9 favoritos
-- - 7 watchlist
-- - 10 reviews

